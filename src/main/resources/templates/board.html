<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="ko">
<!--thymeleaf added-->

<head th:replace="fragment/head">
</head>
<body>
<!--Navigation-->
<navbar th:replace="fragment/navbar"></navbar>
<!--///END Navigation///-->

<!--SUBPAGE HEAD-->
<div class="subpage-head has-margin-bottom">
    <div class="container">
        <h3 id="board_title"></h3>
        <p id="board_info" class="lead"></p>
    </div>
</div>
<!-- // END SUBPAGE HEAD -->

<div class="container">

    <div class="row">
        <div class="col-md-offset-8 col-md-4 blog-search has-margin-bottom">
            <div class="input-group input-group-lg">
                <input id="search_text" type="text" class="form-control" placeholder="Search..">
                <span class="input-group-btn">
          <a class="btn btn-default" type="button" href="javascript:search_result()"><i
                  class="glyphicon glyphicon-search glyphicon-lg"></i></a>
          </span></div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-12 has-margin-bottom" id="blog_list">
            <!--Blog list-->
        </div>
    </div>


    <!-- PAGINATION -->
    <div class="pull-right">
        <a class="btn btn-info">글작성</a>
    </div>
    <div class="text-center center-block">
        <ul class="pagination" id="pageNation">
            <!--pagenation-->
        </ul>
    </div>
    <!--///END PAGINATION///-->

</div>


<!-- FOOTER -->
<footer th:replace="fragment/footer"/>
<script th:replace="fragment/commonScript"/>
<!-- END FOOTER -->
<script th:src="@{../js/custom/pagination.js}" type="text/javascript"></script>


<!--Board List-->
<script>

    // 요청 주소 뒤에 get 파라미터를 매핑한다.
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    // 기본은 dev 게시판
    var type = getParameterByName('type') != null ? getParameterByName('type') : 'dev';

    // 현재 페이지 정보
    var page = getParameterByName('page');

    $(document).ready(function () {
        var board_title;
        var board_info;

        switch (type) {
            case 'dev':
                $('#dev_story_nav').attr('class', 'active');
                board_title = "Dev. Story";
                board_info = "개발 중 어려운 점이 있다면, 언제든지 무엇이든 질문하세요! 만약, 원하는 답변을 찾았다면 RHT로 고마움을 표현하세요.";
                break;
            case 'tech':
                $('#it_story_nav').attr('class', 'active');
                board_title = "IT. Story";
                board_info = "공유하고싶은 지식과 정보를 작성해보세요. 또한, 소개하고 싶은 IT 제품에 대한 글을 남겨보세요.";
                break;
        }

        $('#board_title').text(board_title);
        $('#board_info').text(board_info);

        if (page == null) {
            req_page(1);
        } else {
            req_page(page);
        }
    });

    // 사용자가 원하는 페이지를 요청 번호에 맞춰 반환한다.
    function req_page(requested_page) {
        $.ajax({
            type: 'GET',
            url: "http://localhost:8080/board/list/" + type + "?page=" + requested_page,
            dataType: 'json',
            success: function (result) {

                // 로그인 여부와 종류를 확인한다.
                var login_authority = result.data.authority;

                switch (login_authority) {
                    case 1:
                        login_user();
                        break;
                    default :
                }

                // 게시판 리스트를 초기화 한다..
                $('#blog_list').empty();

                var data = result.data;
                var board_list = data.data;
                var total = data.total;

                // 페이지 리스트를 초기화 한다.
                $('#pageNation').empty();
                set_page(total, requested_page, type);

                for (var i = 0; i < board_list.length; i++) {

                    var seq = board_list[i].BOARD_SEQ;
                    var title = board_list[i].BOARD_TITLE;
                    var content = board_list[i].BOARD_CONTENT;
                    var nick_name = board_list[i].NICK_NAME;
                    var date = board_list[i].BOARD_DATE.substring(0, 10);

                    $('#blog_list').append('  <div class="row has-margin-bottom">' +
                        '<div class="col-md-4 col-sm-4">' +
                        '<img class="img-responsive center-block"  th:src="@{../images/blog-thumb-1.jpg}" alt="bulletin blog"src="images/blog-thumb-1.jpg"> </div>' +
                        '<div class="col-md-8 col-sm-8 bulletin">' +
                        '<a href="/board/content?boardSeq=' + seq + '&type=' + type + ' "><h4 class="media-heading" id="title">' + title + ' </h4></a>' +
                        '<p>' + date + ' <a href="#" class="link-reverse">' + nick_name + '</a></p>' +
                        '<p>' + content + '</p></div></div>');
                }
                window.scrollTo(0, 0);
            },
            error: function () {
                //TODO 에러 페이지 제작 해야 함
                alert("존재하지 않는 페이지 입니다.");
            }
        });
    }


    <!--검색하기 기능-->
    function search_result() {
        var keyword = $('#search_text').val();
        location.href = "/board/search?page=1&searchedWord=" + keyword + "&type=" + type;
    }
</script>

</body>
</html>
