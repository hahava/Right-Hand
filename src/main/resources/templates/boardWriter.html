<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="fragment/head"></head>
<body>
<!-- Navigation Bar -->
<navbar th:replace="fragment/navbar"/>

<!--SUBPAGE HEAD-->
<div class="subpage-head has-margin-bottom">
    <div class="container">
        <h3 id="board_title"></h3>
        <p class="lead" id="board_info"></p>
    </div>
</div>
<!-- // END SUBPAGE HEAD -->

<div class="container has-margin-bottom">
    <div class="row">
        <form class="form-horizontal">
            <div class="form-group">
                <label for="writer_title" class="col-lg-1 col-sm-1 col-md-1 col-xs-1 control-label text-left">제목</label>
                <div class="col-lg-5 col-sm-1 col-md-1 col-xs-1">
                    <input type="email" class="form-control" id="writer_title" placeholder="제목을 작성해주세요">
                </div>
            </div>
        </form>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 has-margin-bottom">
            <div id="editSection"></div>
        </div>
    </div>

    <div class="pull-right">
        <button class="btn btn-info" onclick="write_content()">등록</button>
    </div>
</div>


<!--///END Board info///-->
<footer th:replace="fragment/footer"/>
<script th:replace="fragment/commonScript"/>

<script>

    $(document).ready(function () {

        switch (type) {
            case 'dev':
                $('#dev_story_nav').attr('class', 'active');
                $('#board_title').text("DEV. Story")
                break;
            case 'tech':
                $('#it_story_nav').attr('class', 'active');
                $('#board_title').text("TECH. Story")
                break;
        }

        $('#board_info').text("글작성");
        /*초기화*/
        $('#writer_title').attr('value', '');
    });

    // 기본은 dev 게시판
    var type = getParameterByName('type') != null ? getParameterByName('type') : 'dev';


    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function write_content() {

        var data = {"boardTitle": $('#writer_title').val(), "boardContent": editor.getValue()};
        var writer_success = false;
        $.ajax({
            type: 'POST',
            async: false,
            url: "http://localhost:8080/board/" + type,
            data: JSON.stringify(data),
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            success: function (result) {
                switch (result.code) {
                    case 100:
                        alert("등록 실패 입니다.");
                        writer_success = false;
                        break;
                    case 0:
                        alert("등록되었습니다.");
                        writer_success = true;
                        break;
                }
            }, error: function (e) {
                alert("등록 실패입니다.");
            }
        });


        //성공시 이전 게시글 목록으로 리다이렉트 한다.
        if (writer_success) {
            location.href = "http://localhost:8080/board/list?type=" + type;
        }

    }

    var editor = new tui.Editor({
        el: document.querySelector('#editSection'),
        initialEditType: 'wysiwyg',
        previewStyle: 'vertical',
        height: '400px',
        hideModeSwitch: true
    });

    function submit_text() {
        alert(editor.getValue());
        $('#result').text(function () {
            // var text = editor.getValue().replace(/\!\[.*?\)/gi, '(사진)');
            // text = text.replace(/\#|\*|~|_|-|>/gi, '');
            return text;
        });
    };
</script>

</body>
</html>
